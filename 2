DROP DATABASE ORDERS;
CREATE DATABASE ORDERS;
USE ORDERS;

CREATE TABLE SALESMAN( 
SALESMAN-ID INTEGER PRIMARY KEY, 
NAME VARCHAR(20), 
CITY VARCHAR(20), 
COMMISSION VARCHAR(20));
DESC SALESMAN;


CREATE TABLE CUSTOMER1(
(
CUSTOMER ID INTEGER PRIMARY KEY, 
CITY VARCHAR2 (20),
GRADE NUMBER (3),
PRIMARY KEY (CUSTOMER_ID),
SALESMAN-ID REFERENCES SALESMAN (SALESMAN-ID) ON DELETE SET NULL);
DESC CUSTOMER1;


CREATE TABLE 
ORDERS (ORDER NO INTEGER PRIMARY KEY, 
PURCHASE_AMT NUMBER (10, 2), 
ORD_DATE DATE,
PRIMARY KEY (ORD_NO),
CUSTOMER_ID REFERENCES CUSTOMER1 (CUSTOMER_ID) ON DELETE CASCADE, 
SALESMAN-ID REFERENCES SALESMAN (SALESMAN-ID) ON DELETE CASCADE);
DESC ORDERS;

INSERT INTO SALESMAN VALUE (1000, ‗JOHN„,„BANGALORE„,„25 %„);
INSERT INTO SALESMAN VALUES (1000, ‗JOHN„,„BANGALORE„,„25 %„);
INSERT INTO SALESMAN VALUES (2000, ‗RAVI„,„BANGALORE„,„20 %„); 
INSERT INTO SALESMAN VALUES (3000, ‗KUMAR„,„MYSORE„,„15 %„); 
INSERT INTO SALESMAN VALUES (4000, ‗SMITH„,„DELHI„,„30 %„)
INSERT INTO SALESMAN VALUES (4000, ‗SMITH„,„DELHI„,„30 %„); 
INSERT INTO SALESMAN VALUES (5000, ‗HARSHA„,„HYDRABAD„,„15
%„);

SELECT * FROM SALESMAN;

INSERT INTO CUSTOMER VALUES (11, ‗VIVEK„,„MANGALORE„, 300, 1000); 
INSERT INTO CUSTOMER1 VALUES (10, ‗PREETHI„,„BANGALORE„, 100, 1000); 
INSERT INTO CUSTOMER1 VALUES (11, ‗VIVEK„,„MANGALORE„, 300, 1000); 
INSERT INTO CUSTOMER1 VALUES (12, ‗BHASKAR„,„CHENNAI„, 400, 2000); 
INSERT INTO CUSTOMER1 VALUES (13, ‗CHETHAN„,„BANGALORE„, 200, 2000); 
INSERT INTO CUSTOMER1 VALUES (14, ‗MAMATHA„,„BANGALORE„, 400, 3000)
INSERT INTO CUSTOMER1 VALUES (14, ‗MAMATHA„,„BANGALORE„, 400, 3000);

SELECT * FROM CUSTOMER1;

INSERT INTO ORDRES VALUES (50, 5000, ‗04-MAY-17„, 10, 1000); 
INSERT INTO ORDERS VALUES (50, 5000, ‗04-MAY-17„, 10, 1000); 
INSERT INTO ORDERS VALUES (51, 450, ‗20-JAN-17„, 10, 2000);

INSERT INTO ORDERS VALUES (52, 1000, ‗24-FEB-17„, 13, 2000); 
INSERT INTO ORDERS VALUES (53, 3500, ‗13-APR-17„, 14, 3000); 
INSERT INTO ORDERS VALUES (54, 550, ‗09-MAR-17„, 12,2000);

SELECT * FROM ORDERS;

SELECT GRADE, COUNT (DISTINCT CUSTOMERID) FROM 
CUSTOMER1
GROUP BY GRADE
HAVING GRADE > (SELECT AVG(GRADE) 
FROM CUSTOMER1
WHERE CITY='BANGALORE');


SELECT GRADE, COUNT (DISTINCT CUSTOMER_ID) FROM 
CUSTOMER1
GROUP BY GRADE
HAVING GRADE > (SELECT AVG(GRADE) 
FROM CUSTOMER1
WHERE CITY='BANGALORE');

SELECT SALESMAN-ID, NAME FROM 
SALESMAN A
WHERE 1 < (SELECT COUNT (*) FROM 
CUSTOMER1
WHERE SALESMAN-ID=A.SALESMAN-ID);


SELECT SALESMAN.SALESMAN-ID, NAME, CUST_NAME, COMMISSION FROM 
SALESMAN, CUSTOMER
WHERE SALESMAN.CITY = CUSTOMER.CITY 
UNION
SELECT SALESMANID, NAME, 'NO MATCH', COMMISSION 
FROM SALESMAN
WHERE NOT CITY = ANY 
(SELECT CITY
FROM CUSTOMER) 
ORDER BY 2 DESC;

SELECT SALESMAN.SALESMAN-ID, NAME, CUST_NAME, COMMISSION FROM 
SALESMAN, CUSTOMER1
WHERE SALESMAN.CITY = CUSTOMER1.CITY 
UNION
SELECT SALESMAN-ID, NAME, 'NO MATCH', COMMISSION 
FROM SALESMAN
WHERE NOT CITY = ANY 
(SELECT CITY
FROM CUSTOMER1) 
ORDER BY 2 DESC;

CREATE VIEW ELITSALESMAN AS
SELECT B.ORD_DATE, A.SALESMAN-ID, A.NAME FROM 
SALESMAN A, ORDERS B
WHERE A.SALESMAN-ID = B.SALESMAN-ID
AND B.PURCHASE_AMT=(SELECT MAX (PURCHASE_AMT) 
FROM ORDERS C
WHERE C.ORD_DATE = B.ORD_DATE);

DELETE FROM SALESMAN WHERE 
SALESMAN-ID=1000;
