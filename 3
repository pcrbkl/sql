drop database movie;
CREATE DATABASE MOVIE;
USE MOVIE;

CREATE TABLE ACTOR ( 
	ACT_ID  INTEGER(3) PRIMARY KEY, 
	ACT_NAME VARCHAR (20),
	ACT_GENDER CHAR (1)
);

DESC ACTOR;

CREATE TABLE DIRECTOR ( 
	DIR_ID INTEGER(3) PRIMARY KEY,
	DIR_NAME VARCHAR (20),
	DIR_PHONE BIGINT(10)
);
DESC DIRECTOR;
CREATE TABLE MOVIES ( 
	MOV_ID INTEGER (4) PRIMARY KEY,
	MOV_TITLE VARCHAR (25),
	MOV_YEAR INTEGER (4),
	MOV_LANG VARCHAR (12),
	DIR_ID INTEGER REFERENCES DIRECTOR (DIR_ID) ON DELETE CASCADE
);
DESC MOVIES;
CREATE TABLE MOVIE_CAST ( 
	ACT_ID INTEGER (3),
	MOV_ID INTEGER (4),
	ROLE VARCHAR (10),
	PRIMARY KEY (ACT_ID, MOV_ID),
	FOREIGN KEY (ACT_ID) REFERENCES ACTOR (ACT_ID), 
	FOREIGN KEY (MOV_ID) REFERENCES MOVIES (MOV_ID)
);
DESC MOVIE_CAST;
CREATE TABLE RATING ( 
	MOV_ID INTEGER (4),
	REV_STARS VARCHAR (25),
	PRIMARY KEY (MOV_ID),
	FOREIGN KEY (MOV_ID) REFERENCES MOVIES (MOV_ID)
);

INSERT INTO ACTOR VALUES (301,'ANUSHKA','F');
INSERT INTO ACTOR VALUES (302,'PRABHAS','M');
INSERT INTO ACTOR VALUES (303,'PUNITH','M');
INSERT INTO ACTOR VALUES (304,'JERMY','M');

SELECT * FROM ACTOR;


INSERT INTO DIRECTOR VALUES (60,'RAJAMOULI', 8751611001);
INSERT INTO DIRECTOR VALUES (61,'HITCHCOCK', 7766138911);
INSERT INTO DIRECTOR VALUES (62,'FARAN', 9986776531);
INSERT INTO DIRECTOR VALUES (63,'STEVEN SPIELBERG', 8989776530);

SELECT * FROM DIRECTOR;


INSERT INTO MOVIES VALUES (1001,'BAHUBALI-2', 2017, 'TELAGU', 60);
INSERT INTO MOVIES VALUES (1002,'BAHUBALI-1', 2015, 'TELAGU', 60);
INSERT INTO MOVIES VALUES (1003,'AKASH', 2008, 'KANNADA', 61);
INSERT INTO MOVIES VALUES (1004,'WAR HORSE', 2011, 'ENGLISH', 63);

SELECT * FROM MOVIES;

INSERT INTO MOVIE_CAST VALUES (301, 1002, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (301, 1001, 'HEROINE');
INSERT INTO MOVIE_CAST VALUES (303, 1003, 'HERO');
INSERT INTO MOVIE_CAST VALUES (303, 1002, 'GUEST');
INSERT INTO MOVIE_CAST VALUES (304, 1004, 'HERO');

SELECT * FROM MOVIE_CAST;

INSERT INTO RATING VALUES (1001, 4);
INSERT INTO RATING VALUES (1002, 2);
INSERT INTO RATING VALUES (1003, 5);
INSERT INTO RATING VALUES (1004, 4);



SELECT * FROM RATING;








SELECT MOV_TITLE
	FROM MOVIES
	WHERE DIR_ID IN 
	(SELECT DIR_ID FROM DIRECTOR WHERE DIR_NAME = 'HITCHCOCK');



SELECT MOV_TITLE
	FROM MOVIES M, MOVIE_CAST MV
	WHERE M.MOV_ID = MV.MOV_ID AND ACT_ID IN 
	(SELECT ACT_ID FROM MOVIE_CAST GROUP BY ACT_ID HAVING COUNT(ACT_ID) > 1)
	GROUP BY MOV_TITLE
	HAVING COUNT(*)>1;



SELECT A.ACT_NAME, C.MOV_TITLE, C.MOV_YEAR FROM ACTOR A, MOVIE_CAST B, MOVIES C
	WHERE A.ACT_ID=B.ACT_ID
	AND B.MOV_ID=C.MOV_ID
	AND C.MOV_YEAR NOT BETWEEN 2000 AND 2015;



SELECT MOV_TITLE, MAX(REV_STARS) FROM MOVIES
	INNER JOIN RATING USING (MOV_ID) GROUP BY MOV_TITLE
	HAVING MAX(REV_STARS)>0 ORDER BY MOV_TITLE;




UPDATE RATING
	SET REV_STARS=5
	WHERE MOV_ID IN (SELECT MOV_ID FROM MOVIES
	WHERE DIR_ID IN (SELECT DIR_ID FROM DIRECTOR
	WHERE DIR_NAME = 'STEVEN SPIELBERG'));
